<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Renamer & Comparator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="topbar">
    <div>üìÑ PDF Renamer & Comparator</div>
    <div>
      <span class="muted">Hi, {{ username }}</span>
      <a class="link" href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>

  <div class="container">
    <div class="tabs">
      <button class="tab-btn active" data-tab="rename">üìÇ Rename PDFs</button>
      <button class="tab-btn" data-tab="compare">üîç Compare Folder</button>
    </div>

    <div id="rename" class="tab active">
      <h2>Rename PDFs (strip text after <code>_SLDDRW_</code>)</h2>
      <form id="renameForm">
        <input type="file" name="files[]" id="files" multiple accept=".pdf">
        <button type="submit">Process</button>
      </form>
      <pre id="renameOutput" class="output"></pre>
      <a id="downloadLink" class="btn hidden" href="#" download>‚¨áÔ∏è Download Renamed ZIP</a>
    </div>

    <div id="compare" class="tab">
      <h2>Compare Folder (counts)</h2>
      <p class="muted">Enter a local folder path (on this machine) to count PDFs and those containing <code>_SLDDRW_</code>.</p>
      <div class="row">
        <input id="folderPath" type="text" placeholder="E.g. D:\Docs\PDFs">
        <button id="checkBtn">Check</button>
      </div>
      <pre id="compareOutput" class="output"></pre>
    </div>
  </div>

  <script>
    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // Rename flow
    const form = document.getElementById('renameForm');
    const output = document.getElementById('renameOutput');
    const downloadLink = document.getElementById('downloadLink');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      output.textContent = '‚è≥ Uploading...';
      downloadLink.classList.add('hidden');

      const fd = new FormData(form);
      try {
        const res = await fetch('/rename-pdfs', { method: 'POST', body: fd });
        const data = await res.json();
        if (data.error) {
          output.textContent = '‚ùå ' + data.error;
          return;
        }
        output.textContent = data.output || 'No output';
        if (data.download) {
          downloadLink.href = data.download;
          downloadLink.classList.remove('hidden');
        }
      } catch (err) {
        output.textContent = '‚ùå ' + err;
      }
    });

    // Compare flow
    const folderPathInput = document.getElementById('folderPath');
    const compareOutput = document.getElementById('compareOutput');
    document.getElementById('checkBtn').addEventListener('click', async () => {
      compareOutput.textContent = '‚è≥ Checking...';
      try {
        const res = await fetch('/get-folder-contents', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ folderPath: folderPathInput.value })
        });
        const data = await res.json();
        if (data.error) {
          compareOutput.textContent = '‚ùå ' + data.error;
          return;
        }
        compareOutput.textContent =
          `All files: ${data.total_files}\nPDF files: ${data.pdf_files}\nSLDDRW PDFs: ${data.slddrw_files}\nSample:\n- ${data.sample_files.join("\n- ")}`;
      } catch (err) {
        compareOutput.textContent = '‚ùå ' + err;
      }
    });
  </script>
</body>
</html>
